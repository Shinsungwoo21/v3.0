# MSP-Project-Pilot-Light í˜œë´„ ì‘ì—… ëª©ë¡

> **í”„ë¡œì íŠ¸ ê¸°ê°„**: 2025.12.10 ~ 2026.02.06  
> **ìµœì¢… í’ˆí‰íšŒ**: 2026.02.09  
> **ì‘ì„±ì¼**: 2026.01.09  
> **ì‘ì„± ëª©ì **: í˜œë´„ë‹˜ì´ ì§ì ‘ ìˆ˜í–‰í•œ ì¸í”„ë¼ ë° ì„œë¹„ìŠ¤ ì‘ì—… ì •ë¦¬

---

## ğŸ“Š ì‘ì—… ì¹´í…Œê³ ë¦¬ ìš”ì•½

| ì¹´í…Œê³ ë¦¬ | ì£¼ìš” ë‚´ìš© | ìƒíƒœ |
|----------|----------|------|
| **1. Terraform ì¸í”„ë¼ êµ¬ì¶•** | ì„œìš¸/ë„ì¿„ VPC, EC2, ALB ë°°í¬ | âœ… ì™„ë£Œ |
| **2. MegaTicket ì„œë¹„ìŠ¤ ê°œë°œ** | Next.js ì•±, Bedrock ì±—ë´‡ | âœ… ì™„ë£Œ |
| **3. DynamoDB ì—°ë™** | í…Œì´ë¸” ì„¤ê³„, Global Tables | âœ… ì™„ë£Œ |
| **4. Bedrock AI ì±—ë´‡** | RAG, Tool Use, Cross-Region | âœ… ì™„ë£Œ |
| **5. Step Function NLB ì—ëŸ¬ ë¶„ì„** | ì½”ë“œ ë¶„ì„ ë° í•´ê²° ë°©ì•ˆ ì œì‹œ | âœ… ì™„ë£Œ |
| **6. ë¬¸ì„œí™”** | ê°€ì´ë“œ, íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¬¸ì„œ | âœ… ì™„ë£Œ |

---

## 1. Terraform ì¸í”„ë¼ êµ¬ì¶•

### 1-1. ì„œìš¸ ë¦¬ì „ (Main Region: ap-northeast-2)

| ë¦¬ì†ŒìŠ¤ | ìƒì„¸ |
|--------|------|
| **VPC** | CIDR 10.0.0.0/16 |
| **Subnet** | Public 2ê°œ (ALBìš©), Private 1ê°œ (Web/App) |
| **EC2** | Web EC2, App EC2 (Docker ì»¨í…Œì´ë„ˆ) |
| **ALB** | External ALB (HTTP 80) |
| **Security Group** | í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹ êµ¬ì„± |
| **IAM Role** | EC2 Role (Bedrock, DynamoDB, SSM ê¶Œí•œ) |

### 1-2. ë„ì¿„ ë¦¬ì „ (DR Region: ap-northeast-1)

| ë¦¬ì†ŒìŠ¤ | ìƒì„¸ |
|--------|------|
| **VPC** | CIDR 10.1.0.0/16 (ì„œìš¸ê³¼ ë‹¤ë¥¸ ëŒ€ì—­) |
| **Subnet** | Public 2ê°œ, Private 2ê°œ |
| **EC2** | ASG ê¸°ë°˜ Web/App ì¸ìŠ¤í„´ìŠ¤ |
| **ALB** | External ALB |
| **NLB** | Internal NLB (Web â†’ App í†µì‹ ) |

### 1-3. Terraform êµ¬ì¡°

```
terraform/
â”œâ”€â”€ seoul-test/
â”‚   â”œâ”€â”€ providers.tf
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â””â”€â”€ terraform.tfvars
â”‚
â””â”€â”€ tokyo-dr-test/
    â”œâ”€â”€ providers.tf
    â”œâ”€â”€ main.tf
    â”œâ”€â”€ variables.tf
    â”œâ”€â”€ outputs.tf
    â””â”€â”€ terraform.tfvars
```

**í•µì‹¬ ì„¤ê³„ ì›ì¹™:**
- Multi-Region í´ë” ë¶„ë¦¬ (State íŒŒì¼ ì¶©ëŒ ë°©ì§€)
- S3 Backend + DynamoDB Lock
- ë„¤ì´ë° ì»¨ë²¤ì…˜: `KDT-Msp4-PLDR-*` ë˜ëŠ” `MegaTicket-*`

---

## 2. MegaTicket ì„œë¹„ìŠ¤ ê°œë°œ

### 2-1. ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|------|------|
| **Framework** | Next.js v15.1.0 |
| **Language** | TypeScript |
| **UI** | Tailwind CSS, Shadcn UI |
| **AI** | Amazon Bedrock (Converse API) |
| **DB** | DynamoDB + AWS SDK v3 |
| **ë°°í¬** | Docker, PM2 |

### 2-2. ê°œë°œ ë‹¨ê³„ (Step 1 ~ 7C)

| Phase | ë‹¨ê³„ | ë‚´ìš© | ìƒíƒœ |
|-------|------|------|------|
| Phase 1 | Step 1~2 | í™˜ê²½ ì„¤ì •, Next.js ì´ˆê¸°í™” | âœ… |
| Phase 2 | Step 3~4 | Bedrock ì—°ë™, Chat UI | âœ… |
| Phase 3 | Step 5~6 | ë¡œì»¬ í…ŒìŠ¤íŠ¸, Dockerí™” | âœ… |
| Phase 4 | Step 7-A | RAG êµ¬í˜„ | âœ… |
| Phase 5 | Step 7-B | Tool Use, ì˜ˆì•½ ì‹œìŠ¤í…œ | âœ… |
| Phase 6 | Step 7-C | ìµœì¢… í´ë¦¬ì‹± | âœ… |

### 2-3. ì£¼ìš” íŒŒì¼ êµ¬ì¡°

```
megaticket/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                    # Frontend (Next.js)
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ api/chat/route.ts    # Bedrock API
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat-interface.tsx
â”‚   â”‚   â”‚   â””â”€â”€ seats/seat-map.tsx
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â”œâ”€â”€ bedrock-tools.ts     # Tool Use ì •ì˜
â”‚   â”‚       â””â”€â”€ system-prompt.ts     # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”‚   â”‚
â”‚   â””â”€â”€ app/                    # Backend (API)
â”‚       â””â”€â”€ lib/
â”‚           â””â”€â”€ dynamodb.ts
```

---

## 3. DynamoDB ì—°ë™

### 3-1. í…Œì´ë¸” êµ¬ì¡° (4ê°œ)

| í…Œì´ë¸” | PK | SK | ìš©ë„ |
|--------|----|----|------|
| `KDT-Msp4-PLDR-performances` | `performanceId` | - | ê³µì—° ì •ë³´ |
| `KDT-Msp4-PLDR-venues` | `venueId` | - | ê³µì—°ì¥ ì •ë³´ |
| `KDT-Msp4-PLDR-schedules` | `scheduleId` | - | ê³µì—° ì¼ì • |
| `KDT-Msp4-PLDR-reservations` | `PK` | `SK` | ì˜ˆì•½/ì„ ì  |

### 3-2. Global Tables ì„¤ì •

```
ì„œìš¸ (ap-northeast-2) â†” ë„ì¿„ (ap-northeast-1)
        â”‚                     â”‚
        â””â”€â”€ ì‹¤ì‹œê°„ ë³µì œ (1ì´ˆ ë¯¸ë§Œ) â”€â”€â”˜
```

**RPO**: ìˆ˜ ì´ˆ (ì‹¤ì‹œê°„ ë³µì œ)

### 3-3. GSI (Global Secondary Index)

| í…Œì´ë¸” | GSI ì´ë¦„ | ìš©ë„ |
|--------|----------|------|
| reservations | `userId-index` | ì‚¬ìš©ìë³„ ì˜ˆì•½ ì¡°íšŒ |
| reservations | `holdingId-index` | ì„ ì  ID ì¡°íšŒ |
| reservations | `reservationId-index` | ì˜ˆì•½ ID ì¡°íšŒ |
| schedules | `performanceId-datetime-index` | ê³µì—°ë³„ ì¼ì • ì¡°íšŒ |

### 3-4. TTL ì„¤ì •

| ìš©ë„ | ì†ì„± | ì‹œê°„ |
|------|------|------|
| ì¢Œì„ ì„ ì  (HOLDING) | `holdExpiresAt` | 60ì´ˆ |
| ì·¨ì†Œ ë‚´ì—­ (CANCELLED) | `ttl` | 7ì¼ |

---

## 4. Bedrock AI ì±—ë´‡

### 4-1. ëª¨ë¸ ì„¤ì •

| ì—­í•  | ëª¨ë¸ | Model ID |
|------|------|----------|
| **Primary** | Claude Haiku 4.5 | `anthropic.claude-3-5-haiku-20241022-v1:0` |
| **Fallback** | Amazon Nova Lite | `apac.amazon.nova-lite-v1:0` |

### 4-2. Cross-Region Inference

```
[í‰ì‹œ] ì„œìš¸ Bedrock â†’ ì‘ë‹µ

[íŠ¸ë˜í”½ í­ì¦ ì‹œ - í‹°ì¼“íŒ… ì˜¤í”ˆ]
ì„œìš¸ Bedrock (í˜¼ì¡) â†’ AWS ìë™ ë¶„ì‚° â†’ APAC ë‹¤ë¥¸ ë¦¬ì „
â†’ ê³¼ê¸ˆì€ ì„œìš¸ ê°€ê²© ìœ ì§€
```

### 4-3. Prompt Caching

| ìœ í˜• | ë¹„ìš© |
|------|------|
| Cache Write (ìµœì´ˆ) | +25% |
| Cache Read (5ë¶„ ì´ë‚´) | **-90%** |

**ë¹„ìš© ì ˆê° íš¨ê³¼**: ì•½ 67%

### 4-4. ëŒ€í™” íë¦„ (9ë‹¨ê³„)

```
1. ì¸ì‚¬ â†’ 2. ê³µì—° ì¶”ì²œ â†’ 3. ì¼ì • í™•ì¸ â†’ 4. ì¸ì› í™•ì¸
    â†’ 5. ì¢Œì„ ë“±ê¸‰ â†’ 6. ì¢Œì„ ì¶”ì²œ â†’ 7. ì„ ì  í™•ì¸
    â†’ 8. ì˜ˆì•½ í™•ì • â†’ 9. ì™„ë£Œ ì•ˆë‚´
```

### 4-5. Tool Use (RAG ë„êµ¬)

| ë„êµ¬ | ê¸°ëŠ¥ |
|------|------|
| `get_performances` | ê³µì—° ëª©ë¡ ì¡°íšŒ |
| `get_performance_details` | ê³µì—° ìƒì„¸ ì •ë³´ |
| `get_ticket_availability` | ì¢Œì„ ì”ì—¬ì„ ì¡°íšŒ |
| `hold_seats` | ì¢Œì„ ì„ ì  (60ì´ˆ) |
| `confirm_reservation` | ì˜ˆì•½ í™•ì • |

---

## 5. Step Function NLB ì—ëŸ¬ ë¶„ì„

> âš ï¸ **ì°¸ê³ **: Step Function ì½”ë“œ ì‘ì„±ì€ ë‹¤ë¥¸ íŒ€ì›ì´ ìˆ˜í–‰. í˜œë´„ì€ NLB DNS ë¶ˆì¼ì¹˜ ì—ëŸ¬ ë¶„ì„ ë° í•´ê²° ë°©ì•ˆ ì œì‹œ.

### 5-1. ë°œìƒí•œ ë¬¸ì œ

```
Web EC2 â†’ http://MegaTicket-NLB-xxxx.elb.ap-northeast-2.amazonaws.com (ì„œìš¸)
                                      â†‘
                        ë„ì¿„ NLBê°€ ì•„ë‹Œ ì„œìš¸ NLB í˜¸ì¶œ âŒ
```

### 5-2. ì›ì¸ ë¶„ì„

| ì›ì¸ | ì„¤ëª… |
|------|------|
| Launch Template ë²„ì „ ë¶ˆì¼ì¹˜ | Step2ê°€ ë²„ì „ '2' ì°¸ì¡°, PLACEHOLDERëŠ” ë²„ì „ '7'ì— ì¡´ì¬ |
| NLB ìˆ˜ë™ ì‚­ì œ/ì¬ìƒì„± | Step Function ì™¸ë¶€ì—ì„œ NLB ì‚­ì œ ì‹œ DNS ë¶ˆì¼ì¹˜ |

### 5-3. í•´ê²° ë°©ì•ˆ ì œì‹œ

```python
# Step2 Lambda ìˆ˜ì •
# ë³€ê²½ ì „
Versions=['2']

# ë³€ê²½ í›„
Versions=['7']  # PLACEHOLDERê°€ ìˆëŠ” ë²„ì „
```

### 5-4. ê²€ì¦ ëª…ë ¹ì–´ ì œê³µ

```powershell
# Launch Template UserDataì—ì„œ NLB DNS í™•ì¸
$userData = (aws ec2 describe-launch-template-versions `
  --launch-template-id lt-xxx `
  --versions '$Latest' `
  --region ap-northeast-1 `
  --query "LaunchTemplateVersions[0].LaunchTemplateData.UserData" `
  --output text)

[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($userData)) | Select-String -Pattern "NLB"
```

---

## 6. ë¬¸ì„œí™”

### 6-1. ì‘ì„±í•œ ê°€ì´ë“œ ë¬¸ì„œ

| ë¬¸ì„œ | ë‚´ìš© |
|------|------|
| **MegaTicket ê°œë°œ íˆìŠ¤í† ë¦¬** | Step 1~7C ì§„í–‰ ìƒí™© |
| **DynamoDB ì—°ë™ ê°€ì´ë“œ** | í…Œì´ë¸” ì„¤ê³„, ë§ˆì´ê·¸ë ˆì´ì…˜, TTL |
| **V7.x ì¸ìˆ˜ì¸ê³„ ê°€ì´ë“œ** | Bedrock ëª¨ë¸, í”„ë¡¬í”„íŠ¸, Cross-Region |
| **íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ** | ë¹Œë“œ ì—ëŸ¬, API ì—ëŸ¬ í•´ê²° |

### 6-2. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¬¸ì„œí™”

| ë¬¸ì œ | í•´ê²° |
|------|------|
| 307 ë¦¬ë‹¤ì´ë ‰íŠ¸ | ë¯¸ë“¤ì›¨ì–´ ë¦¬ì „ ê°ì§€ ë¡œì§ ì œê±° |
| 502 Bad Gateway | PM2 ë¯¸ê¸°ë™ â†’ User Data ìˆ˜ì • |
| DynamoDB AccessDeniedException | IAM ì •ì±…ì— ë„ì¿„ ë¦¬ì „ ì¶”ê°€ |
| NLB DNS ë¶ˆì¼ì¹˜ | Launch Template ë²„ì „ ìˆ˜ì • |

---

## ğŸ“‹ í˜œë´„ì´ ì§ì ‘ í•˜ì§€ ì•Šì€ ì‘ì—…

> ì•„ë˜ ì‘ì—…ì€ **ë‹¤ë¥¸ íŒ€ì›**ì´ ìˆ˜í–‰

| ì‘ì—… | ë‹´ë‹¹ |
|------|------|
| Observation Region (ë²„ì§€ë‹ˆì•„) í…Œë¼í¼ | ë‹¤ë¥¸ íŒ€ì› |
| DR Failover ìë™í™” ì „ì²´ êµ¬ì¶• | ë‹¤ë¥¸ íŒ€ì› |
| Step Functions ì½”ë“œ ì‘ì„± | ë‹¤ë¥¸ íŒ€ì› |
| Golden AMI ë¹Œë“œ | ë‹¤ë¥¸ íŒ€ì› |
| EventBridge ê·œì¹™ ì„¤ì • | ë‹¤ë¥¸ íŒ€ì› |
| Route53 Health Check ì„¤ì • | ë‹¤ë¥¸ íŒ€ì› |

---

## ğŸ“Š í•µì‹¬ ì„±ê³¼ ìš”ì•½

| í•­ëª© | ì„±ê³¼ |
|------|------|
| **ì„œë¹„ìŠ¤** | MegaTicket í‹°ì¼“íŒ… AI ì±—ë´‡ ì™„ì„± |
| **ì¸í”„ë¼** | ì„œìš¸/ë„ì¿„ Multi-Region Terraform ë°°í¬ |
| **DB** | DynamoDB Global Tables (RPO ì‹¤ì‹œê°„) |
| **AI** | Bedrock Prompt Caching (67% ë¹„ìš© ì ˆê°) |
| **í˜‘ì—…** | Step Function ì—ëŸ¬ ë¶„ì„ìœ¼ë¡œ íŒ€ ë¬¸ì œ í•´ê²° ê¸°ì—¬ |

---

## ğŸ”— ê´€ë ¨ GitHub

- **MegaTicket ì•±**: https://github.com/seolhyebom/megaticket
- **Terraform ì½”ë“œ**: (private repository)

---

*ì‘ì„±ì: í˜œë´„ (ì„¤í˜œë´„)*
